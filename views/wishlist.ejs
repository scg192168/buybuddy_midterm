<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>wishlist</title>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/vendor/normalize-4.1.1.css">
    <link rel="stylesheet" href="/vendor/border-box.css">
    <link rel="stylesheet" href="/styles/reset.css">
    <link rel="stylesheet" href="/styles/main.css">
    <link rel="stylesheet" href="/styles/layout.css">
    <link rel="stylesheet" href="/styles/_header.css">
    <link rel="stylesheet" href="/public/images/shades.png">

    <!-- JavaScript -->
    <script src="/vendor/jquery-3.0.0.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    <script defer src="/scripts/app.js"></script>
  </head>

  <body>
    <header>
      <%- include('partials/_header2') %>
    </header>

    <div class="container" style="margin-left: 110px; margin-right: 110px;">
      <main>
        <h3><strong>Wishlist</strong></h3>
        <table class="table">
          <tbody>
            <tr style="width: auto;">
              <% wishlists.forEach((wishlist) => { %>
                <td>
                  <section>
                    <img style="width: 250px; height: 250px;" src="<%= wishlist.product_images %>">
                    <h4><strong><%= wishlist.product_title %></strong></h4>
                    <p><%= wishlist.product_description %></p>
                    <h5><strong>$<%= wishlist.product_price %></strong></h5>
                    <form  data-item-id='<%= wishlist.id%>' method="" class="form-delete">
                      <button type="submit" class="delete-btn btn btn-large">Delete</button>
                    </form>
                  </section>
                </td>
              <% }); %>
            </tr>
          </tbody>
        </table>

      </main>
    </div>

     <script>
      // Function to delete a wishlist item by its ID
      function deleteWishlistItem(itemId) {
        fetch(`/wishlist/delete/${itemId}`, {
          method: 'POST',
        })
          .then((response) => {
            if (response) {
              // Item deleted successfully
              //const deletedItem = document.getElementById(`wishlist-item-${itemId}`);
              // if (deletedItem) {
              //   deletedItem.remove();
              // }
              //fetch(`/wishlist`, {method: 'GET'})
              window.location.replace('/wishlist')
            } else {
              console.error('Error deleting wishlist item:', response.statusText);
            }
          })
          .catch((error) => {
            console.error(' request error:', error);
          });
      }
      console.log('test3',document.querySelector('.form-delete'))
      // Attach a click event listener to all "Delete" buttons
      document.querySelectorAll('.form-delete').forEach(Elm => {
        Elm.addEventListener('submit', (event) => {
          event.preventDefault();
console.log('test2',event.target);
          const itemId = event.currentTarget.getAttribute('data-item-id');
          console.log('test',itemId);
          deleteWishlistItem(itemId);
        });
      })

    </script>
    </body>
</html>